class s{constructor(){this.isExpanded=!1,this.widget=null,this.button=null,this.panel=null,this.isResizing=!1,this.initialX=0,this.initialY=0,this.initialWidth=0,this.initialHeight=0,this.init()}init(){this.isListingPage()&&(this.createWidget(),this.loadWidgetContent())}isListingPage(){const t=window.location.href;return Object.values({"zillow.com":/zillow\.com\/homedetails\//,"redfin.com":/redfin\.com\/house\//,"apartments.com":/apartments\.com\/.*\/.*\/.*\/.*\/.*/,"loopnet.com":/loopnet\.com\/Listing\/.*/}).some(i=>i.test(t))}createWidget(){this.button=document.createElement("div"),this.button.id="listing-comments-button",this.button.innerHTML=`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `,this.button.title="Listing Comments",this.panel=document.createElement("div"),this.panel.id="listing-comments-panel",this.panel.innerHTML=`
      <div class="widget-header">
        <h3>Listing Comments</h3>
        <button class="close-btn" id="close-widget">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="widget-content" id="widget-content">
        <div class="loading">Loading comments...</div>
      </div>
      <div class="widget-resize-handle"></div>
    `,this.widget=document.createElement("div"),this.widget.id="listing-comments-widget",this.widget.appendChild(this.button),this.widget.appendChild(this.panel),document.body.appendChild(this.widget),this.addEventListeners()}addEventListeners(){this.button.addEventListener("click",()=>{this.expandWidget()}),document.getElementById("close-widget").addEventListener("click",()=>{this.collapseWidget()}),this.panel.querySelector(".widget-resize-handle").addEventListener("mousedown",e=>{this.startResize(e)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isExpanded&&this.collapseWidget()}),this.panel.addEventListener("click",e=>{e.stopPropagation()})}expandWidget(){this.isExpanded=!0,this.widget.classList.add("expanded"),this.button.style.display="none",this.panel.style.display="block",this.panel.focus()}collapseWidget(){this.isExpanded=!1,this.widget.classList.remove("expanded"),this.button.style.display="flex",this.panel.style.display="none"}startResize(t){t.preventDefault(),this.isResizing=!0,this.initialX=t.clientX,this.initialY=t.clientY,this.initialWidth=this.panel.offsetWidth,this.initialHeight=this.panel.offsetHeight,document.addEventListener("mousemove",this.handleResize.bind(this)),document.addEventListener("mouseup",this.stopResize.bind(this))}handleResize(t){if(!this.isResizing)return;const e=t.clientX-this.initialX,i=t.clientY-this.initialY,n=Math.max(300,this.initialWidth+e),d=Math.max(400,this.initialHeight+i);this.panel.style.width=`${n}px`,this.panel.style.height=`${d}px`}stopResize(){this.isResizing=!1,document.removeEventListener("mousemove",this.handleResize.bind(this)),document.removeEventListener("mouseup",this.stopResize.bind(this))}async loadWidgetContent(){try{const e=await(await fetch(chrome.runtime.getURL("dist/widget/widget.html"))).text(),i=document.getElementById("widget-content");i.innerHTML=e;const n=document.createElement("script");n.type="module",n.src=chrome.runtime.getURL("dist/widget.js"),document.head.appendChild(n)}catch(t){console.error("Failed to load widget content:",t);const e=document.getElementById("widget-content");e.innerHTML='<div class="error">Failed to load comments widget</div>'}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new s}):new s;
